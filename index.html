<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SUGA - Sistema Unificado de Gestão Administrativa</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (to compile JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs (Compat version for single file usage) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <!-- XLSX (SheetJS) for Excel Import -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Plus Jakarta Sans', 'Inter', 'sans-serif'],
            },
            colors: {
              suga: {
                // New Vibrant Palette (Indigo/Violet based)
                dark: '#4338ca',    // Indigo 700 - Primary Brand
                medium: '#6366f1',  // Indigo 500 - Secondary/Hover
                light: '#f8fafc',   // Slate 50 - Background
                accent: '#e0e7ff',  // Indigo 100 - Highlight
                text: '#1e293b',    // Slate 800 - Main Text (High Contrast)
                muted: '#64748b'    // Slate 500 - Secondary Text
              }
            },
            boxShadow: {
              'glow': '0 0 20px rgba(99, 102, 241, 0.5)',
              'card': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
            }
          }
        }
      }
    </script>

    <!-- Custom Styles -->
    <style>
      body {
        background-color: #f8fafc;
        font-family: 'Plus Jakarta Sans', sans-serif;
        color: #1e293b;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f5f9; 
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1; 
        border-radius: 6px;
        border: 2px solid #f1f5f9;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8; 
      }
      
      /* Animations */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }
      
      .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "firebase/": "https://esm.sh/firebase@^12.8.0/",
    "xlsx": "https://esm.sh/xlsx@^0.18.5"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>

    <!-- Main Application Script -->
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // --- FIREBASE CONFIGURATION & SHIMS ---
      const firebaseConfig = {
        apiKey: "AIzaSyA6JvmOJ5FbEDjw2pgZFcemdvh_Zo6C7aM",
        authDomain: "suga-adm.firebaseapp.com",
        projectId: "suga-adm",
        storageBucket: "suga-adm.firebasestorage.app",
        messagingSenderId: "207680956582",
        appId: "1:207680956582:web:411220f21abc478ccd2c67",
        measurementId: "G-ERCKT3ERSN"
      };

      // Initialize Firebase
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      const auth = firebase.auth();
      const db = firebase.firestore();

      // --- SHIMS TO MAKE MODULAR CODE WORK WITH COMPAT SDK ---
      const collection = (dbInstance, path) => dbInstance.collection(path);
      const doc = (dbInstance, path, id) => id ? dbInstance.collection(path).doc(id) : dbInstance.doc(path);
      const addDoc = (ref, data) => ref.add(data);
      const deleteDoc = (ref) => ref.delete();
      const updateDoc = (ref, data) => ref.update(data);
      const where = (field, op, value) => ({ type: 'where', field, op, value });
      const orderBy = (field, direction) => ({ type: 'orderBy', field, direction });
      const Timestamp = firebase.firestore.Timestamp;
      
      const query = (ref, ...constraints) => {
        let q = ref;
        constraints.forEach(c => {
          if (c.type === 'orderBy') q = q.orderBy(c.field, c.direction);
          if (c.type === 'where') q = q.where(c.field, c.op, c.value);
        });
        return q;
      };
      
      const onSnapshot = (queryRef, callback) => {
        return queryRef.onSnapshot(callback);
      };

      const signInWithEmailAndPassword = (authInstance, email, pass) => {
        return authInstance.signInWithEmailAndPassword(email, pass);
      };
      const signOut = (authInstance) => authInstance.signOut();
      const onAuthStateChanged = (authInstance, callback) => authInstance.onAuthStateChanged(callback);


      // --- COMPONENTS ---

      // 1. HighlightText Component
      const HighlightText = ({ text, highlight }) => {
        const val = text || '';
        if (!highlight || !highlight.trim()) {
          return <span>{val}</span>;
        }

        const escapeRegExp = (string) => {
          return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        };

        const regex = new RegExp(`(${escapeRegExp(highlight)})`, 'gi');
        const parts = val.split(regex);

        return (
          <span>
            {parts.map((part, i) => 
              part.toLowerCase() === highlight.toLowerCase() ? (
                <span key={i} className="bg-yellow-300 text-black font-extrabold px-0.5 rounded-sm shadow-sm border-b-2 border-yellow-500">{part}</span>
              ) : (
                <span key={i}>{part}</span>
              )
            )}
          </span>
        );
      };

      // 2. Footer Component
      const Footer = () => (
        <footer className="bg-white/80 backdrop-blur-md py-6 px-6 border-t border-indigo-50 mt-auto">
          <div className="flex items-center justify-between max-w-7xl mx-auto w-full">
            <div className="flex items-center gap-3">
              <div className="h-2 w-2 rounded-full bg-indigo-500 shadow-[0_0_10px_rgba(99,102,241,0.5)]"></div>
              <span className="text-xs text-slate-500 font-bold tracking-widest uppercase">
                Desenvolvido por <span className="text-indigo-600">Jairton Filho</span> © 2025
              </span>
            </div>
            <div className="flex items-center gap-2 text-slate-400">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" className="opacity-50">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
              </svg>
              <span className="text-[10px] font-bold">JAIRTONTECH</span>
            </div>
          </div>
        </footer>
      );

      // 3. Login Component
      const Login = () => {
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        const [error, setError] = useState('');
        const [loading, setLoading] = useState(false);

        const handleLogin = async (e) => {
          e.preventDefault();
          setLoading(true);
          setError('');

          try {
            await signInWithEmailAndPassword(auth, email, password);
          } catch (err) {
            console.error(err);
            setError('Credenciais inválidas. Tente novamente.');
          } finally {
            setLoading(false);
          }
        };

        return (
          <div className="w-full max-w-md animate-fade-in px-4">
            <div className="bg-white rounded-3xl shadow-2xl shadow-indigo-500/20 overflow-hidden border border-white/50">
              <div className="bg-gradient-to-br from-indigo-600 via-violet-600 to-purple-600 p-10 pb-12 text-center flex flex-col items-center relative overflow-hidden">
                {/* Decorative circles */}
                <div className="absolute top-0 left-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -translate-x-10 -translate-y-10"></div>
                <div className="absolute bottom-0 right-0 w-40 h-40 bg-purple-500/20 rounded-full blur-3xl translate-x-10 translate-y-10"></div>
                
                <div className="w-20 h-20 bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center mb-6 shadow-lg border border-white/30 relative z-10 transform rotate-3 hover:rotate-6 transition-transform duration-500">
                  <span className="text-white font-extrabold text-2xl tracking-tighter drop-shadow-md">SUGA</span>
                </div>
                <h1 className="text-white font-bold text-xl tracking-tight uppercase relative z-10">
                  Sistema Unificado
                </h1>
                <p className="text-indigo-100 text-sm mt-2 relative z-10 font-medium">Gestão Administrativa & Operacional</p>
              </div>

              <div className="p-10 pt-8 bg-white relative">
                <form onSubmit={handleLogin} className="space-y-6">
                  <div>
                    <label className="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest pl-1">Email Corporativo</label>
                    <div className="relative">
                      <input
                        type="email"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        placeholder="nome@organizacao.com"
                        className="w-full bg-slate-50 border-2 border-slate-100 text-slate-800 rounded-xl p-3.5 text-sm focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 font-medium transition-all"
                        required
                      />
                    </div>
                  </div>
                  
                  <div>
                    <label className="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest pl-1">Senha de Acesso</label>
                    <input
                      type="password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      placeholder="••••••••"
                      className="w-full bg-slate-50 border-2 border-slate-100 text-slate-800 rounded-xl p-3.5 text-sm focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 font-medium tracking-widest transition-all"
                      required
                    />
                  </div>

                  {error && (
                    <div className="bg-red-50 text-red-500 p-3 rounded-xl text-sm text-center font-semibold border border-red-100 flex items-center justify-center gap-2">
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                       {error}
                    </div>
                  )}

                  <button
                    type="submit"
                    disabled={loading}
                    className="w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-bold py-4 px-4 rounded-xl uppercase text-xs tracking-widest transition-all shadow-xl shadow-indigo-600/20 disabled:opacity-70 disabled:shadow-none transform active:scale-[0.98] mt-2"
                  >
                    {loading ? 'Validando Acesso...' : 'Entrar no Sistema'}
                  </button>
                </form>

                <div className="flex justify-between mt-8 text-xs font-bold text-slate-400 uppercase tracking-wide">
                  <button className="hover:text-indigo-600 transition-colors">Criar Conta</button>
                  <button className="hover:text-indigo-600 transition-colors">Esqueci a Senha</button>
                </div>

                <div className="mt-8 pt-6 border-t border-slate-100 flex justify-between items-center">
                  <div className="flex gap-1.5">
                    <span className="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
                    <span className="h-2 w-2 rounded-full bg-slate-200"></span>
                    <span className="h-2 w-2 rounded-full bg-slate-200"></span>
                  </div>
                  <span className="text-[10px] text-slate-300 font-black tracking-widest">SUGA V5.0</span>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // 4. StatusBadge Component
      const StatusBadge = ({color, label, icon}) => (
        <div className={`flex items-center gap-3 px-4 py-2.5 rounded-xl ${color} shadow-sm border border-black/5`}>
          {icon}
          <span className="text-xs font-bold tracking-wide">{label}</span>
        </div>
      );

      // 5. Dashboard Component
      const Dashboard = ({ navigate }) => {
        return (
          <div className="flex flex-col items-center justify-center min-h-[60vh] animate-fade-in w-full">
            <div className="text-center mb-16 relative">
              <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[300px] bg-indigo-500/5 blur-[100px] rounded-full pointer-events-none"></div>
              <h1 className="text-5xl md:text-6xl font-black text-slate-800 uppercase tracking-tight mb-4 relative z-10">
                Painel de <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-violet-600">Controle</span>
              </h1>
              <p className="text-sm font-bold text-slate-400 tracking-[0.3em] uppercase relative z-10">
                Sistema Unificado de Gestão Administrativa
              </p>
            </div>

            <div className="flex flex-wrap justify-center gap-4 mb-16 relative z-10">
              <StatusBadge 
                color="bg-emerald-50 text-emerald-700" 
                icon={<div className="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></div>}
                label="MÓDULO RH ONLINE" 
              />
              <StatusBadge 
                color="bg-amber-50 text-amber-700" 
                icon={<div className="h-2 w-2 rounded-full bg-amber-500"></div>}
                label="SUÍTE SINCRONIZADO" 
              />
              <StatusBadge 
                color="bg-blue-50 text-blue-700" 
                icon={<div className="h-2 w-2 rounded-full bg-blue-500"></div>}
                label="SERVIDOR ESTÁVEL" 
              />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-5xl px-4 relative z-10">
              {/* Card 1: Pessoal */}
              <div 
                onClick={() => navigate('personnel')}
                className="bg-white rounded-[2rem] p-8 shadow-card hover:shadow-2xl hover:shadow-indigo-500/10 transition-all duration-300 cursor-pointer group border border-slate-100 relative overflow-hidden"
              >
                <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-indigo-100 transition-colors"></div>
                
                <div className="bg-gradient-to-br from-indigo-500 to-violet-600 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 shadow-lg shadow-indigo-500/20 group-hover:scale-110 transition-transform duration-300">
                   <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                </div>
                <div className="flex items-center gap-3 mb-3">
                  <h3 className="text-2xl font-bold text-slate-800 tracking-tight group-hover:text-indigo-600 transition-colors">Relação do Pessoal</h3>
                  <span className="bg-slate-100 text-slate-600 text-[10px] font-bold px-2.5 py-1 rounded-full border border-slate-200">ACESSO TOTAL</span>
                </div>
                <p className="text-sm font-medium text-slate-500 leading-relaxed max-w-sm">
                  Gestão completa e organizacional dos servidores e colaboradores de todas as unidades.
                </p>
              </div>

              {/* Card 2: Processos */}
              <div 
                 onClick={() => navigate('processes')}
                 className="bg-white rounded-[2rem] p-8 shadow-card hover:shadow-2xl hover:shadow-orange-500/10 transition-all duration-300 cursor-pointer group border border-slate-100 relative overflow-hidden"
              >
                <div className="absolute top-0 right-0 w-32 h-32 bg-orange-50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-orange-100 transition-colors"></div>

                <div className="bg-gradient-to-br from-orange-400 to-pink-500 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 shadow-lg shadow-orange-500/20 group-hover:scale-110 transition-transform duration-300">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                </div>
                <div className="flex items-center gap-3 mb-3">
                  <h3 className="text-2xl font-bold text-slate-800 tracking-tight group-hover:text-orange-500 transition-colors">Processos Suite</h3>
                  <span className="bg-orange-50 text-orange-600 text-[10px] font-bold px-2.5 py-1 rounded-full border border-orange-100">NOVO</span>
                </div>
                <p className="text-sm font-medium text-slate-500 leading-relaxed max-w-sm">
                  Consulta rápida de NUP, importação de dados e gestão de fluxo de processos.
                </p>
              </div>
            </div>
          </div>
        );
      };

      // 6. PersonnelDetail Component (NEW)
      const PersonnelDetail = ({ navigate, sector, user }) => {
        const [personnel, setPersonnel] = useState([]);
        const [loading, setLoading] = useState(true);
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [searchTerm, setSearchTerm] = useState('');

        const [formData, setFormData] = useState({
          name: '',
          role: '',
          registration: '',
          status: 'Ativo'
        });

        const getSectorSubtitle = (name) => {
          if (name.includes('CPSB')) return 'COORDENADORIA';
          if (name.includes('CEPP')) return 'CÉLULA';
          return 'UNIDADE OPERACIONAL';
        };

        useEffect(() => {
          if (!sector) return;
          const q = query(collection(db, 'personnel'), where('sector', '==', sector));
          const unsubscribe = onSnapshot(q, (snapshot) => {
            const docs = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            docs.sort((a, b) => a.name.localeCompare(b.name));
            setPersonnel(docs);
            setLoading(false);
          });
          return () => unsubscribe();
        }, [sector]);

        const filteredPersonnel = personnel.filter(p => 
          p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          p.role.toLowerCase().includes(searchTerm.toLowerCase())
        );

        const handleSave = async (e) => {
          e.preventDefault();
          try {
            await addDoc(collection(db, 'personnel'), {
              ...formData,
              sector: sector,
              createdAt: Timestamp.now()
            });
            setIsModalOpen(false);
            setFormData({ name: '', role: '', registration: '', status: 'Ativo' });
          } catch (error) {
            console.error("Error adding personnel:", error);
            alert("Erro ao adicionar funcionário.");
          }
        };

        const handleDelete = async (id) => {
          if (window.confirm('Tem certeza que deseja remover este funcionário?')) {
            await deleteDoc(doc(db, 'personnel', id));
          }
        };

        return (
          <div className="animate-fade-in pb-12">
            <div className="flex flex-col xl:flex-row xl:items-center justify-between gap-6 mb-10">
              <div className="flex items-center gap-6">
                <button 
                  onClick={() => navigate('personnel')}
                  className="w-14 h-14 bg-white rounded-2xl shadow-sm border border-slate-200 flex items-center justify-center text-slate-400 hover:text-white hover:bg-indigo-600 hover:border-indigo-600 hover:shadow-lg hover:shadow-indigo-500/30 transition-all duration-300 shrink-0"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                </button>
                <div>
                  <div className="flex items-center gap-3">
                     <h1 className="text-3xl font-black text-slate-800 uppercase tracking-tight leading-none">{sector}</h1>
                     <span className="bg-indigo-100 text-indigo-700 text-[10px] font-black px-2 py-1 rounded-md uppercase tracking-wider">{getSectorSubtitle(sector)}</span>
                  </div>
                  <p className="text-xs font-bold text-slate-400 uppercase tracking-[0.2em] mt-2">Gestão de Equipe e Colaboradores</p>
                </div>
              </div>

              <div className="flex gap-3">
                 <div className="relative group">
                    <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                      <svg className="h-5 w-5 text-slate-400 group-focus-within:text-indigo-500 transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clipRule="evenodd" />
                      </svg>
                    </div>
                    <input 
                      type="text" 
                      placeholder="Buscar funcionário..." 
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="pl-12 pr-4 bg-white border border-slate-200 rounded-xl py-3 text-sm focus:outline-none focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 min-w-[300px] shadow-sm transition-all font-medium text-slate-600 h-[48px]"
                    />
                  </div>

                  <button 
                    onClick={() => setIsModalOpen(true)}
                    className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-xs px-6 py-3 rounded-xl uppercase transition-all shadow-lg shadow-indigo-600/20 whitespace-nowrap flex items-center gap-2 h-[48px] transform active:scale-95"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Adicionar Membro
                  </button>
              </div>
            </div>

            {loading ? (
               <div className="flex flex-col items-center justify-center h-64">
                  <div className="animate-spin rounded-full h-10 w-10 border-4 border-slate-100 border-t-indigo-600 mb-4"></div>
                  <span className="text-xs font-bold text-slate-300 uppercase tracking-widest">Carregando equipe...</span>
               </div>
            ) : filteredPersonnel.length > 0 ? (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {filteredPersonnel.map((p) => (
                  <div key={p.id} className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 hover:shadow-xl hover:shadow-indigo-500/5 transition-all group relative overflow-hidden">
                     <div className="absolute top-0 right-0 p-4 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onClick={() => handleDelete(p.id)} className="text-slate-300 hover:text-red-500 transition-colors">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                        </button>
                     </div>
                     
                     <div className="flex items-center gap-4 mb-4">
                       <div className="h-14 w-14 rounded-2xl bg-slate-50 flex items-center justify-center text-slate-400 font-black text-lg border border-slate-100">
                          {p.name.charAt(0).toUpperCase()}
                       </div>
                       <div>
                         <h3 className="font-bold text-slate-800 text-base leading-tight">{p.name}</h3>
                         <p className="text-xs font-medium text-indigo-500 mt-1 uppercase tracking-wide">{p.role}</p>
                       </div>
                     </div>
                     
                     <div className="space-y-2 pt-4 border-t border-slate-50">
                       <div className="flex justify-between items-center text-xs">
                         <span className="text-slate-400 font-medium">Matrícula</span>
                         <span className="font-bold text-slate-600 font-mono">{p.registration || '---'}</span>
                       </div>
                       <div className="flex justify-between items-center text-xs">
                         <span className="text-slate-400 font-medium">Status</span>
                         <span className={`px-2 py-0.5 rounded-md font-bold text-[10px] uppercase tracking-wider ${
                           p.status === 'Ativo' ? 'bg-emerald-50 text-emerald-600' : 
                           p.status === 'Férias' ? 'bg-amber-50 text-amber-600' : 'bg-slate-100 text-slate-500'
                         }`}>
                           {p.status}
                         </span>
                       </div>
                     </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="flex flex-col items-center justify-center h-64 text-center bg-white rounded-3xl border border-slate-100 border-dashed">
                <div className="bg-slate-50 rounded-full p-6 mb-4">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-slate-300"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                </div>
                <div className="text-slate-400 font-bold text-sm uppercase tracking-widest mb-1">
                  Nenhum membro encontrado
                </div>
                <p className="text-xs text-slate-300 font-medium">
                  Adicione colaboradores para gerenciar esta unidade
                </p>
              </div>
            )}

            {isModalOpen && (
              <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md animate-fade-in">
                <div className="bg-white rounded-[2rem] shadow-2xl w-full max-w-lg overflow-hidden border border-white/50 transform transition-all scale-100">
                  <div className="bg-gradient-to-r from-indigo-600 to-violet-600 px-8 py-6 flex justify-between items-center">
                    <h2 className="text-white font-bold text-base uppercase tracking-widest flex items-center gap-2">
                       Adicionar Membro
                    </h2>
                    <button onClick={() => setIsModalOpen(false)} className="text-white/70 hover:text-white transition-colors bg-white/10 hover:bg-white/20 rounded-xl p-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                  </div>
                  
                  <form onSubmit={handleSave} className="p-8 space-y-6">
                    <div>
                      <label className="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest">Nome Completo</label>
                      <input
                        type="text"
                        required
                        value={formData.name}
                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                        className="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 font-bold text-slate-700 transition-all"
                        placeholder="Ex: João da Silva"
                      />
                    </div>
                    
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest">Cargo / Função</label>
                        <input
                          type="text"
                          required
                          value={formData.role}
                          onChange={(e) => setFormData({...formData, role: e.target.value})}
                          className="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 font-medium text-slate-700 transition-all"
                          placeholder="Ex: Assistente Administrativo"
                        />
                      </div>
                      <div>
                        <label className="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest">Matrícula</label>
                        <input
                          type="text"
                          value={formData.registration}
                          onChange={(e) => setFormData({...formData, registration: e.target.value})}
                          className="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 font-mono font-medium text-slate-700 transition-all"
                          placeholder="000000-0"
                        />
                      </div>
                    </div>

                    <div>
                      <label className="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest">Status</label>
                      <div className="grid grid-cols-3 gap-3">
                        {['Ativo', 'Férias', 'Licença'].map((statusOption) => (
                          <button
                            key={statusOption}
                            type="button"
                            onClick={() => setFormData({...formData, status: statusOption})}
                            className={`py-3 rounded-xl text-xs font-bold uppercase tracking-wider transition-all border-2 ${
                              formData.status === statusOption 
                              ? 'border-indigo-500 bg-indigo-50 text-indigo-700' 
                              : 'border-slate-100 bg-white text-slate-400 hover:border-indigo-200'
                            }`}
                          >
                            {statusOption}
                          </button>
                        ))}
                      </div>
                    </div>

                    <div className="pt-4 flex gap-3 justify-end border-t border-slate-50 mt-6">
                      <button
                        type="button"
                        onClick={() => setIsModalOpen(false)}
                        className="px-6 py-3 rounded-xl text-xs font-bold text-slate-500 hover:bg-slate-50 transition-colors uppercase tracking-wider"
                      >
                        Cancelar
                      </button>
                      <button
                        type="submit"
                        className="px-8 py-3 rounded-xl text-xs font-bold text-white bg-indigo-600 hover:bg-indigo-500 transition-all shadow-lg shadow-indigo-600/20 uppercase tracking-wider"
                      >
                        Salvar
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}
          </div>
        );
      };

      // 7. PersonnelList Component (Updated)
      const PersonnelList = ({ navigate, onSelectSector }) => {
        const sectors = [
          "CPSB", "CEPP", "CENTRO COMUNITÁRIO FAROL", "CENTRO COMUNITÁRIO SÃO VICENTE",
          "CENTRO COMUNITÁRIO SANTA TEREZINHA", "CENTRO COMUNITÁRIO SÃO FRANCISCO", "ESPAÇO VIVA GENTE",
          "ABC SERRINHA", "ABC MONDUBIM", "ABC CAJUEIRO TORTO", "ABC BOM JARDIM", "ABC PALMEIRAS",
          "CIRCO BOM JARDIM", "CIRCO PALMEIRAS"
        ];

        const getSectorType = (name) => {
          if (name.includes('CPSB')) return 'COORDENADORIA';
          if (name.includes('CEPP')) return 'CÉLULA';
          return 'UNIDADE';
        };

        const handleSelect = (sector) => {
          onSelectSector(sector);
          navigate('personnel-detail');
        };

        return (
          <div className="animate-fade-in pb-10">
            <div className="flex items-center gap-6 mb-10">
              <button 
                onClick={() => navigate('dashboard')}
                className="w-12 h-12 bg-white rounded-2xl shadow-sm border border-slate-200 flex items-center justify-center text-slate-400 hover:text-white hover:bg-indigo-600 hover:border-indigo-600 hover:shadow-lg hover:shadow-indigo-500/30 transition-all duration-300"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                  <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
              </button>
              <div>
                <h1 className="text-3xl font-black text-slate-800 uppercase tracking-tight">Relação do Pessoal</h1>
                <p className="text-xs font-bold text-indigo-500 uppercase tracking-[0.2em] mt-1">Selecione a Unidade ou Setor</p>
              </div>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
              {sectors.map((sector, index) => (
                <div 
                  key={index} 
                  onClick={() => handleSelect(sector)}
                  className="bg-white p-8 rounded-3xl shadow-card hover:shadow-2xl hover:shadow-indigo-500/10 transition-all duration-300 cursor-pointer group min-h-[180px] flex flex-col justify-between border border-slate-100 relative overflow-hidden"
                >
                  <div className="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-slate-50 to-indigo-50 rounded-bl-[4rem] -mr-4 -mt-4 transition-all group-hover:scale-110"></div>
                  
                  <div className="relative z-10">
                    <div className="flex justify-between items-start mb-4">
                      <div className="w-10 h-10 rounded-xl bg-indigo-50 flex items-center justify-center text-indigo-600 group-hover:bg-indigo-600 group-hover:text-white transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                      </div>
                      <span className="text-[10px] font-black text-slate-300 uppercase tracking-wider group-hover:text-indigo-400 transition-colors">
                        {getSectorType(sector)}
                      </span>
                    </div>
                    <h3 className="font-bold text-slate-700 text-sm uppercase leading-relaxed tracking-wide group-hover:text-indigo-700 transition-colors">{sector}</h3>
                  </div>
                  
                  <div className="flex items-center gap-2 relative z-10 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                    <span className="text-[10px] font-bold text-indigo-500 uppercase tracking-widest">
                      Gerenciar Equipe
                    </span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-indigo-500"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                  </div>
                </div>
              ))}
            </div>
          </div>
        );
      };

      // 8. ProcessSuite Component (The Main Logic)
      const ProcessSuite = ({ navigate, user }) => {
        const [processes, setProcesses] = useState([]);
        const [searchTerm, setSearchTerm] = useState('');
        const [selectedYear, setSelectedYear] = useState(''); 
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [loading, setLoading] = useState(true);
        const [importing, setImporting] = useState(false);
        const [editingId, setEditingId] = useState(null);
        const [selectedIds, setSelectedIds] = useState([]);
        
        const role = user?.role;
        const canWrite = role === 'admin' || role === 'operador';
        const canDelete = role === 'admin';

        const [formData, setFormData] = useState({
          data: new Date().toISOString().split('T')[0],
          nup: '',
          description: ''
        });

        const fileInputRef = useRef(null);

        useEffect(() => {
          const q = query(collection(db, 'processes'), orderBy('data', 'desc'));
          const unsubscribe = onSnapshot(q, (snapshot) => {
            const docs = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setProcesses(docs);
            setLoading(false);
          });

          return () => unsubscribe();
        }, []);

        const availableYears = Array.from(new Set(processes.map(p => 
          p.data ? p.data.substring(0, 4) : ''
        ))).filter(y => y && /^\d{4}$/.test(y)).sort().reverse();

        const filteredProcesses = processes.filter(p => {
          const matchesSearch = p.nup.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                p.description.toLowerCase().includes(searchTerm.toLowerCase());
          
          const processYear = p.data ? p.data.substring(0, 4) : '';
          const matchesYear = selectedYear === '' || processYear === selectedYear;

          return matchesSearch && matchesYear;
        });

        const handleOpenNew = () => {
          setEditingId(null);
          setFormData({
            data: new Date().toISOString().split('T')[0],
            nup: '',
            description: ''
          });
          setIsModalOpen(true);
        };

        const handleOpenEdit = (process) => {
          setEditingId(process.id);
          setFormData({
            data: process.data,
            nup: process.nup,
            description: process.description
          });
          setIsModalOpen(true);
        };

        const handleSave = async (e) => {
          e.preventDefault();
          try {
            if (editingId) {
              const docRef = doc(db, 'processes', editingId);
              await updateDoc(docRef, {
                data: formData.data,
                nup: formData.nup,
                description: formData.description
              });
            } else {
              await addDoc(collection(db, 'processes'), {
                data: formData.data,
                nup: formData.nup,
                description: formData.description,
                createdAt: Timestamp.now()
              });
            }
            setIsModalOpen(false);
            setFormData({
              data: new Date().toISOString().split('T')[0],
              nup: '',
              description: ''
            });
          } catch (error) {
            console.error("Error saving document: ", error);
            alert("Erro ao salvar o registro.");
          }
        };

        const handleDelete = async (id) => {
          if (window.confirm('Tem certeza que deseja excluir este registro?')) {
            try {
              await deleteDoc(doc(db, 'processes', id));
              if (selectedIds.includes(id)) {
                setSelectedIds(selectedIds.filter(itemId => itemId !== id));
              }
            } catch (error) {
              console.error("Error deleting document: ", error);
              alert("Erro ao excluir o registro. Verifique suas permissões.");
            }
          }
        };

        const handleBulkDelete = async () => {
          if (!canDelete) return;
          const confirmMessage = selectedIds.length === 1 
            ? 'Tem certeza que deseja excluir o registro selecionado?' 
            : `Tem certeza que deseja excluir os ${selectedIds.length} registros selecionados?`;

          if (window.confirm(confirmMessage)) {
            try {
              const deletePromises = selectedIds.map(id => deleteDoc(doc(db, 'processes', id)));
              await Promise.all(deletePromises);
              setSelectedIds([]);
              alert('Registros excluídos com sucesso.');
            } catch (error) {
              console.error("Error deleting documents: ", error);
              alert("Erro ao excluir registros. Verifique suas permissões.");
            }
          }
        };

        const handleFileUpload = (e) => {
          const file = e.target.files?.[0];
          if (!file) return;

          setImporting(true);
          const reader = new FileReader();
          reader.onload = async (evt) => {
            try {
              const ab = evt.target?.result;
              const wb = XLSX.read(ab, { type: 'array', cellDates: true });
              const wsname = wb.SheetNames[0];
              const ws = wb.Sheets[wsname];
              const data = XLSX.utils.sheet_to_json(ws, { header: 1 });
              
              let importedCount = 0;
              const batchPromises = [];

              const parseDate = (val) => {
                if (!val) return new Date().toISOString().split('T')[0];
                if (val instanceof Date) {
                  const year = val.getFullYear();
                  const month = String(val.getMonth() + 1).padStart(2, '0');
                  const day = String(val.getDate()).padStart(2, '0');
                  return `${year}-${month}-${day}`;
                }
                if (typeof val === 'number') {
                   const date = new Date(Math.round((val - 25569)*86400*1000));
                   date.setHours(12);
                   if (!isNaN(date.getTime())) {
                     const year = date.getFullYear();
                     const month = String(date.getMonth() + 1).padStart(2, '0');
                     const day = String(date.getDate()).padStart(2, '0');
                     return `${year}-${month}-${day}`;
                   }
                }
                if (typeof val === 'string') {
                   const trimmed = val.trim();
                   const ptBrMatch = trimmed.match(/^(\d{1,2})[\/-](\d{1,2})[\/-](\d{2,4})$/);
                   if (ptBrMatch) {
                      const day = ptBrMatch[1].padStart(2, '0');
                      const month = ptBrMatch[2].padStart(2, '0');
                      let year = ptBrMatch[3];
                      if (year.length === 2) year = '20' + year; 
                      return `${year}-${month}-${day}`;
                   }
                   const isoMatch = trimmed.match(/^(\d{4})[\/-](\d{1,2})[\/-](\d{1,2})$/);
                   if (isoMatch) {
                      const year = isoMatch[1];
                      const month = isoMatch[2].padStart(2, '0');
                      const day = isoMatch[3].padStart(2, '0');
                      return `${year}-${month}-${day}`;
                   }
                   const date = new Date(val);
                   if (!isNaN(date.getTime())) return date.toISOString().split('T')[0];
                }
                return new Date().toISOString().split('T')[0];
              };

              for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (row && row.length > 0) {
                  const rawDate = row[0];
                  const rawNup = row[1];
                  const rawDesc = row[2];

                  const dateStr = parseDate(rawDate);
                  const nupStr = String(rawNup || '');
                  const descStr = String(rawDesc || '');

                  if (nupStr.trim() || descStr.trim()) {
                     batchPromises.push(addDoc(collection(db, 'processes'), {
                        data: dateStr,
                        nup: nupStr,
                        description: descStr,
                        createdAt: Timestamp.now()
                     }));
                     importedCount++;
                  }
                }
              }
              await Promise.all(batchPromises);
              alert(`${importedCount} registros importados com sucesso!`);
            } catch (error) {
              console.error("Import error:", error);
              alert("Erro ao processar arquivo.");
            } finally {
              setImporting(false);
              if (fileInputRef.current) fileInputRef.current.value = '';
            }
          };
          reader.readAsArrayBuffer(file);
        };

        const handleSelectAll = (e) => {
          if (e.target.checked) {
            setSelectedIds(filteredProcesses.map(p => p.id));
          } else {
            setSelectedIds([]);
          }
        };

        const handleSelectOne = (id) => {
          if (selectedIds.includes(id)) {
            setSelectedIds(selectedIds.filter(itemId => itemId !== id));
          } else {
            setSelectedIds([...selectedIds, id]);
          }
        };

        const handleExport = () => {
          const itemsToExport = selectedIds.length > 0 
            ? filteredProcesses.filter(p => selectedIds.includes(p.id))
            : filteredProcesses;

          const dataToExport = itemsToExport.map(p => ({
            'Data': p.data ? new Date(p.data + 'T12:00:00').toLocaleDateString('pt-BR') : '',
            'NUP': p.nup,
            'Descrição': p.description
          }));

          const ws = XLSX.utils.json_to_sheet(dataToExport);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Processos");
          const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
          const fileName = selectedIds.length > 0 
            ? `SUGA_Processos_Selecionados_${dateStr}.xlsx`
            : `SUGA_Processos_Geral_${dateStr}.xlsx`;

          XLSX.writeFile(wb, fileName);
        };

        return (
          <div className="relative max-w-[1600px] mx-auto pb-12">
            <div className="animate-fade-in">
              <div className="flex flex-col xl:flex-row xl:items-center justify-between gap-6 mb-10">
                <div className="flex items-center gap-6">
                  <button 
                    onClick={() => navigate('dashboard')}
                    className="w-14 h-14 bg-white rounded-2xl shadow-sm border border-slate-200 flex items-center justify-center text-slate-400 hover:text-white hover:bg-indigo-600 hover:border-indigo-600 hover:shadow-lg hover:shadow-indigo-500/30 transition-all duration-300 shrink-0"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                      <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                  </button>
                  <div>
                    <h1 className="text-3xl font-black text-slate-800 uppercase tracking-tight leading-none mb-1">Processos Suite</h1>
                    <div className="flex gap-3 items-center mt-1">
                      <p className="text-xs font-bold text-indigo-500 uppercase tracking-[0.2em] bg-indigo-50 px-3 py-1 rounded-full">Total: {filteredProcesses.length}</p>
                      {selectedIds.length > 0 && (
                        <span className="text-xs font-bold text-white uppercase tracking-[0.2em] bg-emerald-500 px-3 py-1 rounded-full shadow-md shadow-emerald-500/20">
                          Selecionados: {selectedIds.length}
                        </span>
                      )}
                    </div>
                  </div>
                </div>

                <div className="flex flex-wrap gap-3 items-center">
                  <div className="relative">
                    <select
                      value={selectedYear}
                      onChange={(e) => setSelectedYear(e.target.value)}
                      className="appearance-none bg-white border border-slate-200 rounded-xl py-3 pl-4 pr-10 text-sm focus:outline-none focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 shadow-sm font-bold text-slate-600 cursor-pointer h-[48px] hover:border-indigo-400 transition-colors"
                    >
                      <option value="">Todos os Anos</option>
                      {availableYears.map(year => (
                          <option key={year} value={year}>{year}</option>
                      ))}
                    </select>
                    <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-slate-400">
                      <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                  </div>

                  <div className="relative group">
                    <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                      <svg className="h-5 w-5 text-slate-400 group-focus-within:text-indigo-500 transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clipRule="evenodd" />
                      </svg>
                    </div>
                    <input 
                      type="text" 
                      placeholder="Filtrar processos..." 
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="pl-12 pr-4 bg-white border border-slate-200 rounded-xl py-3 text-sm focus:outline-none focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 min-w-[300px] shadow-sm transition-all font-medium text-slate-600 h-[48px]"
                    />
                  </div>
                  
                  <button 
                    onClick={handleExport}
                    className="bg-white border border-slate-200 text-slate-600 hover:border-indigo-600 hover:text-indigo-600 font-bold text-xs px-6 py-3 rounded-xl uppercase transition-all shadow-sm flex items-center gap-2.5 whitespace-nowrap h-[48px]"
                    title={selectedIds.length > 0 ? "Exportar Selecionados" : "Exportar Todos"}
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    {selectedIds.length > 0 ? `Exportar (${selectedIds.length})` : "Exportar"}
                  </button>

                  {canWrite && (
                    <>
                      <input 
                        type="file" 
                        ref={fileInputRef}
                        onChange={handleFileUpload}
                        accept=".xlsx,.xls,.ods,.csv,.xlsb,.xlsm,.xml,.fods"
                        className="hidden"
                      />
                      
                      <button 
                        onClick={() => fileInputRef.current?.click()}
                        disabled={importing}
                        className="bg-white border border-slate-200 text-slate-600 hover:border-violet-600 hover:text-violet-600 font-bold text-xs px-6 py-3 rounded-xl uppercase transition-all shadow-sm flex items-center gap-2.5 whitespace-nowrap h-[48px]"
                      >
                        {importing ? (
                          <span className="animate-spin h-4 w-4 border-2 border-violet-600 border-t-transparent rounded-full"></span>
                        ) : (
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        )}
                        Importar
                      </button>

                      <button 
                        type="button"
                        onClick={handleOpenNew}
                        className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-xs px-8 py-3 rounded-xl uppercase transition-all shadow-lg shadow-indigo-600/20 whitespace-nowrap flex items-center gap-2 h-[48px] transform active:scale-95"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Novo Registro
                      </button>
                    </>
                  )}

                  {canDelete && selectedIds.length > 0 && (
                     <button 
                      onClick={handleBulkDelete}
                      className="bg-red-50 border border-red-200 text-red-600 hover:bg-red-600 hover:text-white font-bold text-xs px-6 py-3 rounded-xl uppercase transition-all shadow-sm flex items-center gap-2.5 whitespace-nowrap h-[48px]"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                      Excluir ({selectedIds.length})
                    </button>
                  )}
                </div>
              </div>

              <div className="bg-white rounded-[2.5rem] shadow-card border border-slate-100 overflow-hidden">
                <div className="grid grid-cols-12 gap-6 px-10 py-6 bg-slate-50/80 border-b border-slate-100 text-xs font-extrabold text-slate-400 uppercase tracking-widest select-none">
                  <div className="col-span-1 flex items-center">
                    <input 
                      type="checkbox"
                      className="w-5 h-5 rounded-md text-indigo-600 focus:ring-indigo-600 cursor-pointer border-gray-300"
                      onChange={handleSelectAll}
                      checked={filteredProcesses.length > 0 && selectedIds.length === filteredProcesses.length}
                    />
                  </div>
                  <div className="col-span-2">Data</div>
                  <div className="col-span-2">NUP</div>
                  <div className="col-span-5">Descrição do Fluxo</div>
                  <div className="col-span-2 text-right">Ações</div>
                </div>

                {loading ? (
                  <div className="flex flex-col items-center justify-center h-96">
                    <div className="animate-spin rounded-full h-12 w-12 border-4 border-slate-100 border-t-indigo-600 mb-6"></div>
                    <span className="text-sm font-bold text-slate-300 uppercase tracking-widest">Carregando dados...</span>
                  </div>
                ) : filteredProcesses.length > 0 ? (
                  <div className="divide-y divide-slate-50">
                    {filteredProcesses.map((process) => (
                      <div key={process.id} className={`grid grid-cols-12 gap-6 px-10 py-5 items-center transition-all duration-200 group ${selectedIds.includes(process.id) ? 'bg-indigo-50/50' : 'hover:bg-slate-50'}`}>
                        <div className="col-span-1 flex items-center">
                           <input 
                            type="checkbox"
                            className="w-5 h-5 rounded-md text-indigo-600 focus:ring-indigo-600 cursor-pointer border-gray-300"
                            checked={selectedIds.includes(process.id)}
                            onChange={() => handleSelectOne(process.id)}
                          />
                        </div>
                        <div className="col-span-2">
                           <div className="text-sm font-bold text-slate-500">
                            {process.data ? new Date(process.data + 'T12:00:00').toLocaleDateString('pt-BR') : '-'}
                           </div>
                        </div>
                        <div className="col-span-2">
                          <a 
                            href="https://suite.ce.gov.br/" 
                            target="_blank" 
                            rel="noopener noreferrer"
                            onClick={(e) => {
                                if (process.nup) {
                                    navigator.clipboard.writeText(process.nup);
                                }
                            }}
                            className="text-sm font-bold text-indigo-600 font-mono tracking-tight bg-indigo-50 hover:bg-indigo-100 hover:text-indigo-800 inline-flex items-center gap-1.5 px-2 py-1 rounded-md transition-colors cursor-pointer group/link" 
                            title="Abrir no SUITE e Copiar NUP"
                          >
                            <HighlightText text={process.nup || 'Sem NUP'} highlight={searchTerm} />
                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className="opacity-0 group-hover/link:opacity-100 transition-opacity"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                          </a>
                        </div>
                        <div className="col-span-5">
                          <div className="text-base font-medium text-slate-700 leading-relaxed">
                            <HighlightText text={process.description} highlight={searchTerm} />
                          </div>
                        </div>
                        <div className={`col-span-2 flex justify-end gap-3 transition-opacity ${selectedIds.includes(process.id) ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'}`}>
                          {canWrite && (
                            <button 
                              onClick={() => handleOpenEdit(process)}
                              className="h-10 w-10 rounded-xl flex items-center justify-center text-slate-400 hover:text-blue-600 hover:bg-blue-50 transition-all border border-transparent hover:border-blue-100 shadow-sm"
                              title="Editar"
                              type="button"
                            >
                              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                            </button>
                          )}
                          {canDelete && (
                            <button 
                              onClick={() => handleDelete(process.id)}
                              className="h-10 w-10 rounded-xl flex items-center justify-center text-slate-400 hover:text-red-600 hover:bg-red-50 transition-all border border-transparent hover:border-red-100 shadow-sm"
                              title="Excluir"
                              type="button"
                            >
                              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                            </button>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="flex flex-col items-center justify-center h-96 text-center">
                    <div className="bg-slate-50 rounded-full p-8 mb-6">
                      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-slate-300"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
                    </div>
                    <div className="text-slate-400 font-bold text-sm uppercase tracking-widest mb-1">
                      Nenhum registro encontrado
                    </div>
                    <p className="text-xs text-slate-300 font-medium">
                      Utilize o botão "Novo Registro" para começar
                    </p>
                  </div>
                )}
              </div>
            </div>

            {isModalOpen && canWrite && (
              <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md animate-fade-in">
                <div className="bg-white rounded-[2rem] shadow-2xl w-full max-w-xl overflow-hidden border border-white/50 transform transition-all scale-100">
                  <div className="bg-gradient-to-r from-indigo-600 to-violet-600 px-8 py-6 flex justify-between items-center shadow-lg">
                    <h2 className="text-white font-bold text-base uppercase tracking-widest flex items-center gap-2">
                       {editingId ? (
                         <>
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                           Editar Registro
                         </>
                       ) : (
                         <>
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                           Novo Registro
                         </>
                       )}
                    </h2>
                    <button 
                      type="button"
                      onClick={() => setIsModalOpen(false)} 
                      className="text-white/70 hover:text-white transition-colors bg-white/10 hover:bg-white/20 rounded-xl p-2"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                  </div>
                  
                  <form onSubmit={handleSave} className="p-10 space-y-8">
                    <div className="grid grid-cols-2 gap-8">
                      <div>
                        <label className="block text-xs font-bold text-slate-400 uppercase mb-3 tracking-widest">Data do Registro</label>
                        <input
                          type="date"
                          required
                          value={formData.data}
                          onChange={(e) => setFormData({...formData, data: e.target.value})}
                          className="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-4 text-sm focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 font-bold text-slate-700 transition-all"
                        />
                      </div>
                      <div>
                        <label className="block text-xs font-bold text-slate-400 uppercase mb-3 tracking-widest">Número NUP</label>
                        <input
                          type="text"
                          required
                          placeholder="00000.000000/0000-00"
                          value={formData.nup}
                          onChange={(e) => setFormData({...formData, nup: e.target.value})}
                          className="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-4 text-sm focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 font-bold text-slate-700 transition-all font-mono"
                        />
                      </div>
                    </div>
                    
                    <div>
                      <label className="block text-xs font-bold text-slate-400 uppercase mb-3 tracking-widest">Descrição detalhada</label>
                      <textarea
                        required
                        rows={5}
                        placeholder="Insira os detalhes do processo aqui..."
                        value={formData.description}
                        onChange={(e) => setFormData({...formData, description: e.target.value})}
                        className="w-full bg-slate-50 border-2 border-slate-100 rounded-xl p-4 text-base focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 font-medium text-slate-700 resize-none transition-all"
                      />
                    </div>

                    <div className="pt-6 flex gap-4 justify-end border-t border-slate-50 mt-6">
                      <button
                        type="button"
                        onClick={() => setIsModalOpen(false)}
                        className="px-6 py-4 rounded-xl text-xs font-bold text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition-colors uppercase tracking-wider"
                      >
                        Cancelar
                      </button>
                      <button
                        type="submit"
                        className="px-10 py-4 rounded-xl text-xs font-bold text-white bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 transition-all transform active:scale-95 uppercase tracking-wider shadow-xl shadow-indigo-600/20 flex items-center gap-3"
                      >
                        {editingId ? 'Salvar Alterações' : 'Confirmar Registro'}
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}
          </div>
        );
      };

      // 9. Layout Component
      const Layout = ({ children, user, currentView, onLogout, navigate }) => {
        if (currentView === 'login') {
          return (
            <div className="min-h-screen flex flex-col justify-between bg-slate-50/50">
              <div className="flex-grow flex items-center justify-center p-4">
                {children}
              </div>
              <Footer />
            </div>
          );
        }

        return (
          <div className="min-h-screen flex flex-col bg-slate-50">
            {/* Header */}
            <header className="bg-white/80 backdrop-blur-xl border-b border-indigo-50 px-8 py-5 flex justify-between items-center shadow-sm sticky top-0 z-40">
              <div className="flex items-center gap-4 cursor-pointer group" onClick={() => navigate('dashboard')}>
                <div className="bg-gradient-to-br from-indigo-600 to-violet-600 text-white font-extrabold p-2 rounded-xl px-3 text-sm shadow-lg shadow-indigo-500/20 group-hover:scale-105 transition-transform">SUGA</div>
                <div className="hidden md:flex flex-col">
                  <span className="text-slate-800 font-black text-sm tracking-wide uppercase group-hover:text-indigo-600 transition-colors">Sistema Unificado</span>
                  <span className="text-[10px] text-slate-400 font-bold tracking-[0.2em] uppercase">Gestão Administrativa</span>
                </div>
              </div>
              
              <div className="flex items-center gap-6">
                <div className="text-right hidden sm:block">
                  <div className="text-xs text-slate-500 font-medium">OLÁ, <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-violet-600 font-black uppercase">{user?.role || 'USUÁRIO'}</span></div>
                  <div className="text-[10px] text-slate-400 font-bold tracking-wider">{user?.email || 'ADMINISTRADOR'}</div>
                </div>
                <div className="h-10 w-10 rounded-2xl bg-gradient-to-br from-indigo-100 to-violet-100 flex items-center justify-center text-indigo-700 font-black text-sm border border-indigo-200 shadow-inner">
                  {user?.email?.charAt(0).toUpperCase() || 'A'}
                </div>
                <button 
                  onClick={onLogout}
                  className="bg-red-50 hover:bg-red-100 text-red-600 hover:text-red-700 text-xs font-bold py-2.5 px-5 rounded-xl transition-all border border-red-100"
                >
                  SAIR
                </button>
              </div>
            </header>

            {/* Main Content */}
            <main className="flex-grow p-6 md:p-10 overflow-auto">
              <div className="max-w-[1600px] mx-auto">
                {children}
              </div>
            </main>

            <Footer />
          </div>
        );
      };

      // 10. Main App Component
      const App = () => {
        const [user, setUser] = useState(null);
        const [loading, setLoading] = useState(true);
        const [currentView, setCurrentView] = useState('login');
        const [selectedSector, setSelectedSector] = useState(null);

        useEffect(() => {
          const unsubscribe = onAuthStateChanged(auth, async (authUser) => {
            if (authUser) {
              const userRole = 'admin';

              setUser({
                name: authUser.displayName || 'Usuário',
                email: authUser.email,
                role: userRole
              });

              if (currentView === 'login') {
                setCurrentView('dashboard');
              }
            } else {
              setUser(null);
              setCurrentView('login');
            }
            setLoading(false);
          });

          return () => unsubscribe();
        }, [currentView]);

        const handleLogout = async () => {
          try {
            await signOut(auth);
            setCurrentView('login');
            setSelectedSector(null);
          } catch (error) {
            console.error("Error signing out", error);
          }
        };

        const navigate = (view) => {
          setCurrentView(view);
        };

        const handleSelectSector = (sector) => {
          setSelectedSector(sector);
        };

        if (loading) {
          return (
            <div className="min-h-screen bg-slate-50 flex items-center justify-center">
              <div className="flex flex-col items-center">
                <div className="h-16 w-16 bg-gradient-to-br from-indigo-600 to-violet-600 rounded-2xl mb-6 animate-bounce shadow-xl shadow-indigo-500/30"></div>
                <div className="h-1.5 w-40 bg-slate-200 rounded-full overflow-hidden">
                   <div className="h-full bg-indigo-500 w-1/2 animate-[shimmer_1s_infinite]"></div>
                </div>
              </div>
            </div>
          );
        }

        return (
          <Layout 
            user={user} 
            currentView={currentView} 
            onLogout={handleLogout}
            navigate={navigate}
          >
            {currentView === 'login' && <Login />}
            {currentView === 'dashboard' && <Dashboard navigate={navigate} />}
            {currentView === 'personnel' && <PersonnelList navigate={navigate} onSelectSector={handleSelectSector} />}
            {currentView === 'personnel-detail' && selectedSector && <PersonnelDetail navigate={navigate} sector={selectedSector} user={user} />}
            {currentView === 'processes' && <ProcessSuite navigate={navigate} user={user} />}
          </Layout>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  </body>
</html>